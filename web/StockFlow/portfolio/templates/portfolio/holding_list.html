<!DOCTYPE html>
<html>
<head>
    <title>Holdings</title>
</head>
<body>
    {% load humanize %}

    <h1>Holding</h1>

    <!-- 'urlpatterns[]の"holding_create"からurlを逆引きする -->
    <a href="{% url 'holding_create' %}">新規追加</a>

    {% if last_updated %}
        <p>最終更新日: {{ last_updated|date:"Y-m-d" }}</p>
    {% endif %}

    <table>
      <thead>
        <tr>
          <th>名前</th><th>Ticker</th><th>数量</th><th>平均買値</th><th>現在価格</th><th>評価額（円）</th><th>損益（円）</th>
        </tr>
      </thead>
      <tbody>
        {% for h in holdings %}
        <tr>
          <td>{{ h.name }}</td>
          <td>{{ h.ticker }}</td>
          <td>{{ h.quantity|intcomma }}</td>
          <td>{{ h.average_price|floatformat:2|intcomma}}</td>
          <td>{{ h.current_price|floatformat:2|intcomma}}</td>
          <td>{{ h.valuation_jpy|floatformat:0|intcomma }} 円</td>
          <td>
              {% if h.profit_jpy >= 0 %}
                  <span style="color:green;">{{ h.profit_jpy|floatformat:0|intcomma}} 円</span>
              {% else %}
                  <span style="color:red;">{{ h.profit_jpy|floatformat:0|intcomma}} 円</span>
              {% endif %}
          </td>
          <td>
            <a href="{% url 'holding_edit' h.pk %}">編集</a>
            <a href="#" onclick="deleteHolding({{ h.pk }}); return false;">削除</a>
            <form id="delete-form-{{ h.pk }}" action="{% url 'holding_delete' h.pk %}" method="post" style="display:none;">
               {% csrf_token %}
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <script>
        function deleteHolding(id) {
            if (confirm("削除しますか?")) {
                document.getElementById(`delete-form-${id}`).submit();
            }
        }
    </script>
</body>

</html>

